name: Daily PushPlus Notification

on:
  schedule:
    # GitHub Actions 使用 UTC 时间
    # 北京/台北时间 09:30 = UTC 时间 01:30
    # 格式: 分 时 日 月 周
    - cron: '30 1 * * *'
  
  # 允许手动点击按钮触发（方便测试）
  workflow_dispatch:

jobs:
  run-pushplus:
    runs-on: ubuntu-latest

    steps:
      # 1. 检出代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'

      # 3. 安装依赖 (关键修复：强制安装 requests)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          # 如果仓库中有 requirements.txt 则安装，否则继续
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          # 手动安装 requests，防止报错
          pip install requests

      # 4. 运行脚本
      - name: Run python main.py
        env:
          # 左边是 Python 代码里读取的变量名
          # 右边是 GitHub Secrets 的引用
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
        run: python main.py
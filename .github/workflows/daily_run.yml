name: Daily PushPlus

on:
  schedule:
    # GitHub Actions 使用 UTC 时间 (UTC 0:00 是北京时间 8:00)
    - cron: '0 0 * * *' 

  # 允许手动点击按钮触发（方便测试）
  workflow_dispatch:

jobs:
  run-pushplus:
    runs-on: ubuntu-latest

    steps:
      # 1. 检出代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 安装 uv (这是使用 pyproject.toml 的最佳方式)
      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          version: "latest"
          enable-cache: true

      # 3. 设置 Python 环境 (根据 pyproject.toml 要求使用 3.12)
      - name: Set up Python
        run: uv python install 3.12

      # 4. 运行脚本 (uv run 会自动处理 pyproject.toml 中的所有依赖)
      - name: Run Gold Price Script
        env:
          # 配置环境变量
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
          PUSHPLUS_TOPIC: ${{ secrets.PUSHPLUS_TOPIC }}
        run: uv run main.py
